/* This script creates the tables for the consultant schema and populates
the table with some sample data.

It is not intended that the trainer lead the class through this script.

For an introduction to using DDL, see Module 3a_DDL1_Samples.sql
*/

  DROP TABLE assignment;
  DROP TABLE consultant;
  DROP TABLE client;
  DROP TABLE address;
  
  CREATE TABLE address 
 (ADDRESS_ID NUMBER(4) CONSTRAINT Address_PK PRIMARY KEY, 
 	HOUSE_NUMBER NUMBER(4) NOT NULL, 
	STREET VARCHAR2(20 ) NOT NULL, 
	TOWN VARCHAR2(20 ) NOT NULL
 );

INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (1,42,'Acacia Avenue','Linlithgow');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (2,69,'Acre Lane','Linlithgow');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (3,66,'Greek Street','Bathgate');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (4,21,'Glasgow Road','Armadale');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (5,4,'Plato Road','Whitecross');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (6,19,'Leibniz Crescent','Armadale');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (7,22,'Wallace Court','Whitecross');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (8,21,'Bruce Road','Livingston');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (9,16,'Nelson Terrace','Linlithgow');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (10,98,'Portland Square','Falkirk');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (11,5,'Hamilton Court','Linlithgow');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (12,43,'Royal Terrace','Falkirk');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (13,76,'Carlisle Court','Livingston');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (14,132,'Brimley Mansions','Falkirk');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (15,45,'Gallagher Crescent','Armadale');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (16,92,'Elm Street','Whitecross');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (17,34,'Ponsonby Road','Falkirk');
INSERT INTO address (ADDRESS_ID,HOUSE_NUMBER,STREET,TOWN) VALUES (18,45,'Lomond Road','Balloch');


  CREATE TABLE consultant
   (CONSULTANT_ID NUMBER(4) CONSTRAINT CON_PK PRIMARY KEY, 
    FIRST_NAME VARCHAR2(20) NOT NULL, 
    LAST_NAME VARCHAR2(20) NOT NULL, 
	  BIRTH_DATE DATE NOT NULL, 
    BOSS_ID NUMBER(4) NULL CONSTRAINT cons_boss_fk REFERENCES consultant(consultant_id), 
	  ADDRESS_ID NUMBER(4) NOT NULL CONSTRAINT cons_add_fk REFERENCES address(address_id)
   );


INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (1,'Bill','Partridge',TO_DATE('11-JAN-1960','dd-MON-yyyy'),null,1);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (2,'Vernon','Schillinger',TO_DATE('16-MAY-1975','dd-MON-yyyy'),1,2);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (3,'Simon','Adebisi',TO_DATE('25-APR-1980','dd-MON-yyyy'),1,3);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (4,'Penelope','Barber',TO_DATE('01-MAY-1978','dd-MON-yyyy'),2,4);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (5,'Kareem','Said',TO_DATE('04-APR-1984','dd-MON-yyyy'),2,5);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (6,'Chris','Keller',TO_DATE('09-FEB-1977','dd-MON-yyyy'),1,6);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (7,'Augustus','Hill',TO_DATE('03-DEC-1976','dd-MON-yyyy'),6,7);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (8,'Nicholas','Beecher',TO_DATE('22-OCT-1974','dd-MON-yyyy'),6,8);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (9,'Alan','Metcalfe',TO_DATE('30-OCT-1980','dd-MON-yyyy'),6,9);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (10,'Bill','Sykes',TO_DATE('29-FEB-1980','dd-MON-yyyy'),2,10);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (11,'Susan','Schillinger',TO_DATE('27-JUL-1976','dd-MON-yyyy'),1,2);
INSERT INTO consultant (CONSULTANT_ID,FIRST_NAME,LAST_NAME,BIRTH_DATE,BOSS_ID,ADDRESS_ID) VALUES (12,'Susan','Adler',TO_DATE('23-JUL-1973','dd-MON-yyyy'),1,4);
   
  CREATE TABLE client 
   (CLIENT_ID NUMBER(4) CONSTRAINT CLIENT_PK PRIMARY KEY, 
	  CLIENT_NAME VARCHAR2(50 ) NOT NULL, 
  	ADDRESS_ID NUMBER(4) NOT NULL CONSTRAINT client_address_fk REFERENCES address(address_id)
    );

INSERT INTO CLIENT (CLIENT_ID,CLIENT_NAME,ADDRESS_ID) VALUES (1,'Hamilton Finance',11);
INSERT INTO CLIENT (CLIENT_ID,CLIENT_NAME,ADDRESS_ID) VALUES (2,'Terrace Bank',12);
INSERT INTO CLIENT (CLIENT_ID,CLIENT_NAME,ADDRESS_ID) VALUES (3,'Carlisle Enterprises',13);
INSERT INTO CLIENT (CLIENT_ID,CLIENT_NAME,ADDRESS_ID) VALUES (4,'Brimley Real Estate',14);
INSERT INTO CLIENT (CLIENT_ID,CLIENT_NAME,ADDRESS_ID) VALUES (5,'Brimley Furniture',14);
INSERT INTO CLIENT (CLIENT_ID,CLIENT_NAME,ADDRESS_ID) VALUES (6,'Armadale Savings And Loan',15);
INSERT INTO CLIENT (CLIENT_ID,CLIENT_NAME,ADDRESS_ID) VALUES (7,'Whitecross Insurance',16);

CREATE TABLE assignment
   (ASSIGNMENT_ID NUMBER(4)CONSTRAINT ASSIGN_PK PRIMARY KEY, 
	  CLIENT_ID NUMBER(4)     NOT NULL CONSTRAINT assignment_client_fk REFERENCES client(client_id), 
   	CONSULTANT_ID NUMBER(4) NULL CONSTRAINT assignment_consultant_fk REFERENCES consultant(consultant_id),
    START_DATE DATE NULL,
    END_DATE   DATE NULL,
    PAY NUMBER(8,2) NULL, 
    COMMENTS VARCHAR2(140) NULL
   );


INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (1, 2, 1, TRUNC(SYSDATE-100,'Q'),TRUNC(SYSDATE-100,'Q')+31,500, null);
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (2, 4, 1, SYSDATE-65,SYSDATE-30,120, 'Technical App Support Role');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (3, 5, 2, SYSDATE-90,SYSDATE-60,750, 'Business Analysis Role');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (4, 6, 2, SYSDATE-100,SYSDATE-70,750, 'S/W Testing');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (5, 7, 2, SYSDATE-120,SYSDATE-90,350, 'App Support Level 1');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (6, 2, 3, SYSDATE-120,SYSDATE-90,500, 'Business Analysis Role');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (7, 2, 3, SYSDATE-89,SYSDATE-65,400, 'Technical App Support Role');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (8, 9, 3, SYSDATE-60,null,400, 'Project Management');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (9, 5, 4, null,null,625, 'S/W Testing');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,START_DATE,END_DATE,PAY,COMMENTS) 
  VALUES (10, 7, 4, SYSDATE-85, SYSDATE-55, 625, 'Level 3 App Support');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,PAY,COMMENTS) 
  VALUES (11, 7, 5, null,'Java Development');

-- The consultant_id is intentionally null for the following assignments (for FULL OUTER JOIN demo)
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,PAY,COMMENTS) 
  VALUES (21, null,6,null,'.NET Development');
INSERT INTO ASSIGNMENT (ASSIGNMENT_ID, CONSULTANT_ID,CLIENT_ID,PAY,COMMENTS) 
  VALUES (22, null,6,null,'.NET Development');

COMMIT;

-- TABLE STATISTICS
DECLARE
 l_schema VARCHAR2(30);
BEGIN
  SELECT 
     sys_context( 'userenv', 'current_schema' ) 
  INTO l_schema
  FROM dual;

  DBMS_STATS.GATHER_TABLE_STATS(l_schema,'ASSIGNMENT');
  DBMS_STATS.GATHER_TABLE_STATS(l_schema,'CLIENT');
  DBMS_STATS.GATHER_TABLE_STATS(l_schema,'CONSULTANT');
  DBMS_STATS.GATHER_TABLE_STATS(l_schema,'ADDRESS');

END;
/